<!DOCTYPE html>
<html>
<head>
    <title>Firebase Test</title>
</head>
<body>
    <h1>Firebase Database Test</h1>
    <div id="status">Testing...</div>
    <div id="data"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js'
        import { getDatabase, ref, onValue, limitToLast, query, orderByKey } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js'

        const firebaseConfig = {
            apiKey: "AIzaSyA5IRjwAdvgSQ8K9sTkfdjEgFO_P1K-PdM",
            authDomain: "skyforge-4606b.firebaseapp.com", 
            databaseURL: "https://skyforge-4606b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "skyforge-4606b",
            storageBucket: "skyforge-4606b.firebasestorage.app",
            messagingSenderId: "113983013806",
            appId: "1:113983013806:web:b37570450de08e7a147e3f"
        }

        console.log('üî• Testing Firebase connection...')
        document.getElementById('status').textContent = 'Connecting to Firebase...'

        try {
            const app = initializeApp(firebaseConfig)
            const db = getDatabase(app)
            
            console.log('‚úÖ Firebase initialized')
            document.getElementById('status').textContent = 'Firebase initialized, checking database...'

            // Test root nodes
            const rootRef = ref(db, '/')
            onValue(rootRef, (snapshot) => {
                const data = snapshot.val()
                console.log('üìÅ Database root:', data)
                
                if (data) {
                    const nodes = Object.keys(data)
                    document.getElementById('status').textContent = `Found nodes: ${nodes.join(', ')}`
                    
                    // Test telemetry specifically
                    if (nodes.includes('telemetry')) {
                        const telemetryRef = ref(db, 'telemetry')
                        const latestQuery = query(telemetryRef, orderByKey(), limitToLast(3))
                        
                        onValue(latestQuery, (snapshot) => {
                            const telemetryData = snapshot.val()
                            console.log('üìä Telemetry data:', telemetryData)
                            
                            let output = '<h2>Telemetry Data:</h2>'
                            if (telemetryData) {
                                Object.entries(telemetryData).forEach(([key, record]) => {
                                    output += `<div><strong>${key}:</strong> ${JSON.stringify(record, null, 2)}</div><br>`
                                })
                            } else {
                                output += '<div>No telemetry data found</div>'
                            }
                            
                            document.getElementById('data').innerHTML = output
                        })
                    }
                } else {
                    document.getElementById('status').textContent = 'Database is empty or no read permission'
                }
            }, { onlyOnce: true })

        } catch (error) {
            console.error('‚ùå Firebase error:', error)
            document.getElementById('status').textContent = `Error: ${error.message}`
        }
    </script>
</body>
</html>
