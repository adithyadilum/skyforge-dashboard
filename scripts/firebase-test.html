<!DOCTYPE html>
<html>
<head>
    <title>Firebase Database Test</title>
</head>
<body>
    <h1>Firebase Database Test</h1>
    <div id="results"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js'
        import { getDatabase, ref, onValue, query, orderByKey, limitToLast } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js'

        const firebaseConfig = {
            apiKey: "AIzaSyA5IRjwAdvgSQ8K9sTkfdjEgFO_P1K-PdM",
            authDomain: "skyforge-4606b.firebaseapp.com",
            databaseURL: "https://skyforge-4606b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "skyforge-4606b",
            storageBucket: "skyforge-4606b.firebasestorage.app",
            messagingSenderId: "113983013806",
            appId: "1:113983013806:web:b37570450de08e7a147e3f"
        }

        const app = initializeApp(firebaseConfig)
        const db = getDatabase(app)
        const results = document.getElementById('results')

        function log(message) {
            console.log(message)
            results.innerHTML += '<p>' + message + '</p>'
        }

        log('üîç Testing Firebase database connectivity...')

        // Test root level
        const rootRef = ref(db, '/')
        onValue(rootRef, (snapshot) => {
            const data = snapshot.val()
            if (data) {
                log('‚úÖ Root level nodes: ' + Object.keys(data).join(', '))
                
                // Now test each potential path
                testPath('sensor_data')
                testPath('telemetry')
                testPath('history')
            } else {
                log('‚ùå No data found at root level')
            }
        }, (error) => {
            log('‚ùå Error reading root: ' + error.message)
        })

        function testPath(path) {
            log(`\nüìä Testing path: ${path}`)
            const pathRef = ref(db, path)
            const pathQuery = query(pathRef, orderByKey(), limitToLast(1))
            
            onValue(pathQuery, (snapshot) => {
                const data = snapshot.val()
                if (data) {
                    const latestKey = Object.keys(data)[0]
                    const latestRecord = data[latestKey]
                    log(`‚úÖ Found data in ${path}:`)
                    log(`   Key: ${latestKey}`)
                    log(`   Fields: ${Object.keys(latestRecord).join(', ')}`)
                    log(`   Sample: ${JSON.stringify(latestRecord).substring(0, 200)}...`)
                } else {
                    log(`‚ùå No data found in ${path}`)
                }
            }, (error) => {
                log(`‚ùå Error reading ${path}: ${error.message}`)
            })
        }
    </script>
</body>
</html>
